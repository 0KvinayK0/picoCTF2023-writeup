# babygame01

## Challenge

### Description

Get the flag and reach the exit.

Welcome to BabyGame! Navigate around the map and see what you can find! The game is available to download [here](./game).

There is no source available, so you'll have to figure your way around the map. You can connect with it using `nc saturn.picoctf.net 51300`.

### Hints

1. Use 'w','a','s','d' to move around.
2. There may be secret commands to make your life easy.

## Solution

After decompiling the program with Ghidra, we have the main function.

```c
undefined4 main(undefined param_1)

{
    int iVar1;
    undefined4 uVar2;
    int in_GS_OFFSET;
    int local_aac;
    int local_aa8;
    char local_aa4;
    undefined local_aa0 [2700];
    int local_14;
    undefined *local_10;

    local_10 = &param_1;
    local_14 = *(int *)(in_GS_OFFSET + 0x14);
    init_player(&local_aac);
    init_map((int)local_aa0,&local_aac);
    print_map((int)local_aa0,(int)&local_aac);
    signal(2,sigint_handler);
    do {
        do {
            iVar1 = getchar();
            move_player(&local_aac,(char)iVar1,(int)local_aa0);
            print_map((int)local_aa0,(int)&local_aac);
        } while (local_aac != 0x1d);
    } while (local_aa8 != 0x59);
    puts("You win!");
    if (local_aa4 != '\0') {
        puts("flage");
        win();
        fflush(stdout);
    }
    uVar2 = 0;
    if (local_14 != *(int *)(in_GS_OFFSET + 0x14)) {
        uVar2 = __stack_chk_fail_local();
    }
    return uVar2;
}
```

This program prints out the flag if upon winning the game, the value stored in `local_aa4` is not `\0`. The player coordinates are stored in `local_aac` and `local_aa8`. The map is stored at `local_aa0`, which is right after `local_aa4` in the stack.

```c
void move_player(int *param_1,char param_2,int param_3)

{
    int iVar1;

    if (param_2 == 'l') {
        iVar1 = getchar();
        player_tile = (undefined)iVar1;
    }
    if (param_2 == 'p') {
        solve_round(param_3,param_1);
    }
    *(undefined *)(*param_1 * 0x5a + param_3 + param_1[1]) = 0x2e;
    if (param_2 == 'w') {
        *param_1 = *param_1 + -1;
    }
    else if (param_2 == 's') {
        *param_1 = *param_1 + 1;
    }
    else if (param_2 == 'a') {
        param_1[1] = param_1[1] + -1;
    }
    else if (param_2 == 'd') {
        param_1[1] = param_1[1] + 1;
    }
    *(undefined *)(*param_1 * 0x5a + param_3 + param_1[1]) = player_tile;
    return;
}
```

On the line `*(undefined *)(*param_1 * 0x5a + param_3 + param_1[1]) = player_tile`, `param_1` stores the value of the x coordinate of the player, and `param_1[1]` stores the y coordinate, `params_3` points to the start of the map array. This means we can modify values on the stack outside of the map array by manipulating the player coordinates. For example to access the value 4 bytes before the map (map is at `0xaa0`, 4 bytes before is `local_aa4`, according to Ghidra), we move the player to position (0, -4), so that `(*param_1 * 0x5a + param_3 + param_1[1])` will become `*(params_3 - 4) = player_tile`, which is essentially `local_aa4 = player_tile`.

We get the flag by connecting with:

```console
$ echo "wwwwaaaaaaaap" | nc saturn.picoctf.net 51300
```

## Flag

picoCTF{gamer_m0d3_enabled_3aa88304}
